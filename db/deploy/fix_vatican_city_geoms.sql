-- Deploy emapic:fix_vatican_city_geoms to pg
-- requires: base_layers

BEGIN;

    UPDATE base_layers.countries SET geom = st_geomfromtext('MULTIPOLYGON(((12.4544180852091 41.9014187835471,12.4545336131108 41.9002258969407,12.4517689883682 41.9003908631209,12.4500661946593 41.900897911257,12.4482040122027 41.9007884233447,12.4458065829511 41.9019305515556,12.4481905872112 41.9033100530278,12.4491290889613 41.9049508206341,12.4507470003626 41.906406436581,12.4554332580376 41.9073124946077,12.4556898898703 41.9063401615532,12.4575061116284 41.9058097864668,12.4576572718575 41.9033690481613,12.4583450337507 41.902603465652,12.4583943570132 41.9018061126107,12.4578401427449 41.901215730194,12.4569720426051 41.9012302053216,12.4562714538987 41.9017266878351,12.4544180852091 41.9014187835471)))', 4326),
        simp_geom = st_geomfromtext('MULTIPOLYGON(((12.4583608833652 41.9022435660088,12.4517968578598 41.9004584511143,12.4459232337841 41.9019479269558,12.4553632675378 41.9073125908647,12.4583608833652 41.9022435660088)))', 4326)
        WHERE name = 'Vatican';

    UPDATE base_layers.provinces SET geom = st_geomfromtext('MULTIPOLYGON(((12.4544180852091 41.9014187835471,12.4545336131108 41.9002258969407,12.4517689883682 41.9003908631209,12.4500661946593 41.900897911257,12.4482040122027 41.9007884233447,12.4458065829511 41.9019305515556,12.4481905872112 41.9033100530278,12.4491290889613 41.9049508206341,12.4507470003626 41.906406436581,12.4554332580376 41.9073124946077,12.4556898898703 41.9063401615532,12.4575061116284 41.9058097864668,12.4576572718575 41.9033690481613,12.4583450337507 41.902603465652,12.4583943570132 41.9018061126107,12.4578401427449 41.901215730194,12.4569720426051 41.9012302053216,12.4562714538987 41.9017266878351,12.4544180852091 41.9014187835471)))', 4326),
        simp_geom = st_geomfromtext('MULTIPOLYGON(((12.4583608833652 41.9022435660088,12.4517968578598 41.9004584511143,12.4459232337841 41.9019479269558,12.4553632675378 41.9073125908647,12.4583608833652 41.9022435660088)))', 4326)
        WHERE name = 'Vatican';

    UPDATE base_layers.countries SET geom = st_multi(st_difference(geom, (select geom from base_layers.countries where name = 'Vatican'))),
        simp_geom = st_multi(st_difference(simp_geom, (select simp_geom from base_layers.countries where name = 'Vatican')))
        WHERE name = 'Italy';

    UPDATE base_layers.provinces SET geom = st_multi(st_difference(geom, (select geom from base_layers.countries where name = 'Vatican'))),
        simp_geom = st_multi(st_difference(simp_geom, (select simp_geom from base_layers.countries where name = 'Vatican')))
        WHERE name = 'Roma';

COMMIT;
